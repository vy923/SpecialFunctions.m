function [out] = sinintx(x)%#codegen
%
% ----------------------------------------------------
% MODS: Added +inf checks
% ----------------------------------------------------
%
%SININT_APPROX A fast approximation of sinint to ~machine precision
%   This function approximates the integral of sinc(t)=sin(t)/t for the
%   range of 0 to x. The resulting function is often called Si(x) as e.g.
%   found at https://en.wikipedia.org/wiki/Trigonometric_integral .
%   The function uses Padé approximants to approximate the form of sinint;
%   one for the range x\in(-4,4) and another for other values of x. The
%   approximating coefficients were derived in Maple.
%
%   NB: The code computes 'res1' and 'res2' for all x, which I found to be
%   faster and less error-prone than computing 'res1' for |x|<=4 and 'res2'
%   for the remaining x. However, in case your 'x' occupies only a
%   particular range (say, only within |x|<4), it may be worth optimizing
%   the code for a further speedup.
%
%   Usage:    Si_x = sinint_approx(x)
%   where 'x' is an 1xN or Nx1 vector.
%
%   Example: xx=[-2:0.001:2]; figure; plot( xx, sinint(xx) - sinint_approx(xx), '.' )
%   
% Made by Erik Koene, 03-Dec-2019, ETH Zürich, Switzerland.

% --- For |x|<=4
xx = x.^2;
res1 = (1. + (-0.044892736924152932551844244723997846822763245144215 + (0.0011308148286214949015400505665749546213592662129364 + (-0.000013518513045422193918459076580806032001171640892159 + (8.7806412642191398862740606289763012585529144654208e-8 + (-3.1533259132226738320780987898999114399084004611787e-10 + (5.9814953972397454403609816132655051261053733213094e-13 - 4.7504638886243685222289962465128598610805952258039e-16.*xx).*xx).*xx).*xx).*xx).*xx).*xx).*x./ ...
       (1. + (0.010662818631402623003711310831557708732792310411340 + (0.000056526974810529512857345612772605106514394569121947 + (1.9518126019468852434626140498514530268395727372043e-7 + (4.7984367174378037111906486393943342464470212754005e-10 + (8.5179435292817281385363881118809269124713142839250e-13 + (1.0277122545130474915858348491405098995553871676395e-15 + 6.6301333777855267993884149725812116218267904187122e-19.*xx).*xx).*xx).*xx).*xx).*xx).*xx);
% --- For |x|>4
xa = abs(x);
f = cos(xa).*(1594.49414485728430466332 + (8275.84818940137243992368 + (10162.66725435130728219521 + (4621.09376158198177426960 + (1104.79150340448842011825 + (155.86443071108822510675 + (13.46187152508710208340 + (0.68710640648526182614 + (0.01831638978414741773 + (0.00010731479342397587 + 6.48414130354561676847e-21.*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa) ...
           ./(1055.36600633109566229551 + (7495.20045213474334935414 + (14836.36245684622804160274 + (12114.44595587052587301708 + (4919.15125736805024272896 + (1131.34887326881593964943 + (157.23649773262430321943 + (13.49850430086108383867 + (0.68732103608970899993 + (0.01831638978410423849 + 0.00010731479342401745.*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa);
g = sin(xa).*(182.51168366912221077876 + (1530.28380598126532842505 + (2549.84671726169670626077 + (1038.79858619779457828551 + (213.04792031653464900619 + (25.69147648762354247238 + (1.89479338456939692760 + (0.08136199755970253940 + (0.00170248701236117895 + (-8.08898584293122883292*10^(-17) + 1.42503883826931327455e-20.*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa) ...
           ./(50.84848276040178897437 + (983.14002528084120208960 + (4068.76922048341926039043 + (5923.54873750012648969252 + (3675.25295529027484561335 + (1186.11747942635035473484 + (224.27360249416711211008 + (26.17964925638780558475 + (1.90500830057264324471 + (0.08136199758913992172 + 0.00170248701228424740.*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa).*xa);
res2 = sign(x).*(pi/2-f-g);
% --- Get it all together.
out = res1 .* (xa<=4) + res2 .* (xa>4);
% --- MOD/VY
out(x==inf) = pi/2;